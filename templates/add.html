{% extends 'base.html' %}
{% block page %}
    {% include 'components/header.html' %}
    <main>
      <div class="Page">
        <form class="Form" action="" method="POST" autocomplete="off" id="eventForm">
            {{ form.csrf_token }}

          <div class="Form__box">

            <div class="Form__field">
              {{ form.title.label }}
              {{ form.title(placeholder="'Hang out with Frank the Phoenix!'") }}
            </div>

            <div class="Form__row">
              <div class="Form__row__time">
                <label>Date & Time</label>
                <div class="Form__row__time__fields">
                  <input placeholder="mm/dd/yyyy hh:mm xm" onfocus="(this.type='datetime-local')" id={{form.dtstart}}
                  <p>to</p>
                  <input placeholder="mm/dd/yyyy hh:mm xm" onfocus="(this.type='datetime-local')" id={{form.dtend}}
                </div>
              </div>
              <div class="Form__row__day">
                <input type="checkbox" id="isallday" name="isallday">
                <label for="isallday">Mark as "All Day"<span>(this ignores the start & end time)<span></label>
              </div>
            </div>

            <div class="Form__field">
              {{ form.location.label }}
              {{ form.location(placeholder="'Dining Hall' or 'olin.zoom.us/j/123456789'") }}
            </div>

            <div class="Form__field">
              <label>Category
                <svg class="Form__tooltip" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span class="Form__tooltip__text">Choose the one that best describes the type of your event or whoâ€™s hosting it. If still unsure, refer to the FAQ.</span>
              </label>
              <div class="Form__category">
                {{ form.category }}
              </div>
            </div>

            <div class="Form__field">
              {{ form.description.label }}
              {{ form.description(placeholder="Who might be interested? What would they be doing? Is there anything they need to have done before hand?") }}
            </div>

            <div class="Form__field">
                <label>Host Name
                  <svg class="Form__tooltip" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                  <span class="Form__tooltip__text">A host can be either an individual or a group on campus. This will be displayed on the event page.</span>
                </label>
                {{ form.host_name(placeholder="'Frankie Olin' or 'The Phoenix Club'") }}
                <label>Point of Contact Email
                  <svg class="Form__tooltip" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                  <span class="Form__tooltip__text">This email will receive updates from the moderator team. It will also be displayed for people to reach out with questions.</span>
                </label>
                {{ form.host_email(placeholder="'frankie@olin.edu' or 'phoenixclub@olin.edu'") }}
            </div>

          </div>
          <input class="Form__submit" id="submitButton" type="submit" name="Submit" value="Submit Event" />
        </form>
      </div>
    </main>
    {% include 'components/footer.html' %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.6.0/cleave.min.js"></script>
    <script>

        function validateForm(e) {

            document.getElementById('dtstart').value = dtstart;
            document.getElementById('dtend').value = dtend;

            if (dtstart > dtend) {
              alert("Start Time cannot be later than End Time!");
              window.history.forward(-1);
              e.preventDefault(); // Prevent form from being submitted
              return;
            }

            // Must be an Olin Email
            var emailPattern = /.*@olin\.edu/
            var email = document.getElementById('host_email').value;

            if (!emailPattern.test(email)) {
                alert("You must use an Olin email!");
                e.preventDefault()
                return;
            }


            document.getElementById('dtstart').value = dtstart;
            document.getElementById('dtend').value = dtend;
        }

        document.querySelectorAll('[name="duration"]')
            .forEach(el => {
                // On click, the proper form fields should be shown
                el.addEventListener('click', e => {
                    // Remove from the ones currently have it
                    document.querySelectorAll('.js-showFieldSet')[0]
                        .classList.remove('js-showFieldSet');

                    // And add it to the proper one
                    var nextElement = document.getElementById("duration--" + e.target.value);
                    nextElement.classList.add('js-showFieldSet');
                })
            })

        document.getElementById('submitButton')
            .addEventListener('click', e => validateForm(e))

    </script>
{% endblock %}
